---
title: データベース関数 - EF Core
description: EF Core のクエリ変換でサポートされているデータベース関数に関する情報
author: smitpatel
ms.date: 11/10/2020
uid: core/querying/database-functions
ms.openlocfilehash: 34ced2a602168f6ed84763c046ef581cb87026e8
ms.sourcegitcommit: 42bbf7f68e92c364c5fff63092d3eb02229f568d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/11/2020
ms.locfileid: "94503782"
---
# <a name="database-functions"></a><span data-ttu-id="7de1b-103">データベース関数</span><span class="sxs-lookup"><span data-stu-id="7de1b-103">Database Functions</span></span>

<span data-ttu-id="7de1b-104">データベース関数は、データベースで [C# のメソッド](/dotnet/csharp/programming-guide/classes-and-structs/methods)に相当するものです。</span><span class="sxs-lookup"><span data-stu-id="7de1b-104">Database functions are the database equivalent of [C# methods](/dotnet/csharp/programming-guide/classes-and-structs/methods).</span></span> <span data-ttu-id="7de1b-105">データベース関数は 0 個以上のパラメーターを使用して呼び出すことができ、パラメーターの値に基づいて結果が計算されます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-105">A database function can be invoked with zero or more parameters and it computes the result based on the parameter values.</span></span> <span data-ttu-id="7de1b-106">クエリに SQL を使用するほとんどのデータベースにより、データベース関数がサポートされています。</span><span class="sxs-lookup"><span data-stu-id="7de1b-106">Most databases, which use SQL for querying have support for database functions.</span></span> <span data-ttu-id="7de1b-107">そのため、EF Core のクエリ変換によって生成される SQL でも、データベース関数を呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-107">So SQL generated by EF Core query translation also allows invoking database functions.</span></span> <span data-ttu-id="7de1b-108">C# のメソッドを、EF Core のデータベース関数に厳密に変換する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="7de1b-108">C# methods don't have to translate strictly to database functions in EF Core.</span></span>

- <span data-ttu-id="7de1b-109">C# のメソッドには同等のデータベース関数がない場合があります。</span><span class="sxs-lookup"><span data-stu-id="7de1b-109">A C# method may not have an equivalent database function.</span></span>
  - <span data-ttu-id="7de1b-110"><xref:System.String.IsNullOrEmpty%2A?displayProperty=nameWithType> メソッドは、null チェックと、関数ではなくデータベース内の空の文字列との比較に変換されます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-110"><xref:System.String.IsNullOrEmpty%2A?displayProperty=nameWithType> method translates to a null check and a comparison with an empty string in the database rather than a function.</span></span>
  - <span data-ttu-id="7de1b-111">文字列比較はデータベースでは表現できないか、簡単に模倣できないため、<xref:System.String.Equals(System.String,System.StringComparison)?displayProperty=nameWithType> メソッドと同等のものはデータベースにはありません。</span><span class="sxs-lookup"><span data-stu-id="7de1b-111"><xref:System.String.Equals(System.String,System.StringComparison)?displayProperty=nameWithType> method doesn't have database equivalent since string comparison can't be represented or mimicked easily in a database.</span></span>
- <span data-ttu-id="7de1b-112">データベース関数には、それに相当する C# メソッドがない場合があります。</span><span class="sxs-lookup"><span data-stu-id="7de1b-112">A database function may not have an equivalent C# method.</span></span> <span data-ttu-id="7de1b-113">メソッドを持たない C# の `??` 演算子は、データベースの `COALESCE` 関数に変換されます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-113">The `??` operator in C#, which doesn't have any method, translates to the `COALESCE` function in the database.</span></span>

## <a name="types-of-database-functions"></a><span data-ttu-id="7de1b-114">データベース関数の種類</span><span class="sxs-lookup"><span data-stu-id="7de1b-114">Types of database functions</span></span>

<span data-ttu-id="7de1b-115">EF Core の SQL 生成でサポートされているのは、データベースで使用できる関数のサブセットです。</span><span class="sxs-lookup"><span data-stu-id="7de1b-115">EF Core SQL generation supports a subset of functions that can be used in databases.</span></span> <span data-ttu-id="7de1b-116">この制限は、特定のデータベース関数を LINQ のクエリで表す機能に由来します。</span><span class="sxs-lookup"><span data-stu-id="7de1b-116">This limitation comes from the ability to represent a query in LINQ for the given database function.</span></span> <span data-ttu-id="7de1b-117">さらに、データベース関数のサポートはデータベースごとに異なるため、EF Core により共通のサブセットが提供されています。</span><span class="sxs-lookup"><span data-stu-id="7de1b-117">Further, each database has varying support of database functions, so EF Core provides a common subset.</span></span> <span data-ttu-id="7de1b-118">データベース プロバイダーは、EF Core の SQL 生成を自由に拡張して、より多くのパターンをサポートできます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-118">A database provider is free to extend EF Core SQL generation to support more patterns.</span></span> <span data-ttu-id="7de1b-119">EF Core によってサポートされて個別に識別されるデータベース関数の種類を次に示します。</span><span class="sxs-lookup"><span data-stu-id="7de1b-119">Following are the types of database functions EF Core supports and uniquely identifies.</span></span> <span data-ttu-id="7de1b-120">これらの用語は、EF Core プロバイダーによって組み込まれている変換を理解するのにも役立ちます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-120">These terms also help in understanding what translations come built in with EF Core providers.</span></span>

### <a name="built-in-vs-user-defined-functions"></a><span data-ttu-id="7de1b-121">組み込み関数とユーザー定義関数</span><span class="sxs-lookup"><span data-stu-id="7de1b-121">Built-in vs user-defined functions</span></span>

<span data-ttu-id="7de1b-122">組み込み関数はデータベースであらかじめ定義されていますが、ユーザー定義関数はユーザーによってデータベースで明示的に定義されます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-122">Built-in functions come with database predefined, but user-defined functions are explicitly defined by the user in the database.</span></span> <span data-ttu-id="7de1b-123">EF Core によってクエリがデータベース関数を使用するように変換される場合は、その関数をデータベースで常に使用できるように、組み込み関数が使用されます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-123">When EF Core translates queries to use database functions, it uses built-in functions to make sure that the function is always available on the database.</span></span> <span data-ttu-id="7de1b-124">データベースによっては、SQL を正しく生成するために組み込み関数を区別する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7de1b-124">The distinction of built-in functions is necessary in some databases to generate SQL correctly.</span></span> <span data-ttu-id="7de1b-125">たとえば、SqlServer の場合は、すべてのユーザー定義関数をスキーマ修飾名で呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="7de1b-125">For example SqlServer requires that every user-defined function is invoked with a schema-qualified name.</span></span> <span data-ttu-id="7de1b-126">一方、SqlServer の組み込み関数にはスキーマはありません。</span><span class="sxs-lookup"><span data-stu-id="7de1b-126">But built-in functions in SqlServer don't have a schema.</span></span> <span data-ttu-id="7de1b-127">PostgreSQL の場合は、組み込み関数は `public` スキーマで定義されていますが、スキーマ修飾名を使用して呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-127">PostgreSQL defines built-in function in the `public` schema but they can be invoked with schema-qualified names.</span></span>

### <a name="aggregate-vs-scalar-vs-table-valued-functions"></a><span data-ttu-id="7de1b-128">集計関数とスカラー関数とテーブル値関数</span><span class="sxs-lookup"><span data-stu-id="7de1b-128">Aggregate vs scalar vs table-valued functions</span></span>

- <span data-ttu-id="7de1b-129">スカラー関数は、スカラー値 (整数や文字列など) をパラメーターとして受け取り、結果としてスカラー値を返します。</span><span class="sxs-lookup"><span data-stu-id="7de1b-129">Scalar functions take scalar values - like integers or strings - as parameters and return a scalar value as the result.</span></span> <span data-ttu-id="7de1b-130">スカラー関数は、スカラー値を渡すことができる SQL のすべての場所で使用できます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-130">Scalar functions can be used anywhere in SQL where a scalar value can be passed.</span></span>
- <span data-ttu-id="7de1b-131">集計関数は、スカラー値のストリームをパラメーターとして受け取り、結果としてスカラー値を返します。</span><span class="sxs-lookup"><span data-stu-id="7de1b-131">Aggregate functions take a stream of scalar values as parameters and return a scalar value as the result.</span></span> <span data-ttu-id="7de1b-132">集計関数は、クエリ結果セット全体または `GROUP BY` 演算子を適用することによって生成される値のグループに適用されます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-132">Aggregate functions are applied on the whole query result set or on a group of values generated by applying `GROUP BY` operator.</span></span>
- <span data-ttu-id="7de1b-133">テーブル値関数は、スカラー値をパラメーターとして受け取り、結果として行のストリームを返します。</span><span class="sxs-lookup"><span data-stu-id="7de1b-133">Table-valued functions take scalar values as parameter(s) and return a stream of rows as the result.</span></span> <span data-ttu-id="7de1b-134">テーブル値関数は、`FROM` 句のテーブル ソースとして使用されます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-134">Table-valued functions are used as a table source in `FROM` clause.</span></span>

### <a name="niladic-functions"></a><span data-ttu-id="7de1b-135">ニラディック関数</span><span class="sxs-lookup"><span data-stu-id="7de1b-135">Niladic functions</span></span>

<span data-ttu-id="7de1b-136">ニラディック関数は、パラメーターを持たず、かっこを使用せずに呼び出す必要がある、特別なデータベース関数です。</span><span class="sxs-lookup"><span data-stu-id="7de1b-136">Niladic functions are special database functions that don't have any parameters and must be invoked without parenthesis.</span></span> <span data-ttu-id="7de1b-137">それらは、C# のインスタンスでのプロパティやフィールドのアクセスに似ています。</span><span class="sxs-lookup"><span data-stu-id="7de1b-137">They're similar to property/field access on an instance in C#.</span></span> <span data-ttu-id="7de1b-138">ニラディック関数は、空のかっこが必要なパラメーターなし関数とは異なるものです。</span><span class="sxs-lookup"><span data-stu-id="7de1b-138">Niladic functions differ from parameter-less functions as the latter require empty parenthesis.</span></span> <span data-ttu-id="7de1b-139">常にかっこが必要なデータベース関数には、特別な名前はありません。</span><span class="sxs-lookup"><span data-stu-id="7de1b-139">There's no special name for database functions that requires parenthesis always.</span></span> <span data-ttu-id="7de1b-140">パラメーターの数に基づくデータベース関数のもう 1 つのサブセットは、可変個引数関数です。</span><span class="sxs-lookup"><span data-stu-id="7de1b-140">Another subset of database functions based on parameter count is variadic functions.</span></span> <span data-ttu-id="7de1b-141">可変個引数関数は、呼び出されるときに、異なる数のパラメーターを受け取ることができます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-141">Variadic functions can take varying number of parameters when invoked.</span></span>

## <a name="database-function-mappings-in-ef-core"></a><span data-ttu-id="7de1b-142">EF Core でのデータベース関数のマッピング</span><span class="sxs-lookup"><span data-stu-id="7de1b-142">Database function mappings in EF Core</span></span>

<span data-ttu-id="7de1b-143">EF Core では、C# 関数とデータベース関数の間のマッピングに 3 つの異なる方法がサポートされています。</span><span class="sxs-lookup"><span data-stu-id="7de1b-143">EF Core supports three different ways of mapping between C# functions and database functions.</span></span>

### <a name="built-in-function-mapping"></a><span data-ttu-id="7de1b-144">組み込み関数のマッピング</span><span class="sxs-lookup"><span data-stu-id="7de1b-144">Built-in function mapping</span></span>

<span data-ttu-id="7de1b-145">既定では、EF Core プロバイダーが、プリミティブ型に対するさまざまな組み込み関数のマッピングを提供します。</span><span class="sxs-lookup"><span data-stu-id="7de1b-145">By default EF Core providers provide mappings for various built-in functions over primitive types.</span></span> <span data-ttu-id="7de1b-146">たとえば、SqlServer では <xref:System.String.ToLower?displayProperty=nameWithType> は `LOWER` に変換されます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-146">For example, <xref:System.String.ToLower?displayProperty=nameWithType> translates to `LOWER` in SqlServer.</span></span> <span data-ttu-id="7de1b-147">この機能により、ユーザーは LINQ でシームレスにクエリを作成できます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-147">This functionality allows users to write queries in LINQ seamlessly.</span></span> <span data-ttu-id="7de1b-148">通常は、クライアント側で C# 関数によって提供されるものと同じ結果を提供する変換が、データベースに用意されています。</span><span class="sxs-lookup"><span data-stu-id="7de1b-148">We usually provide a translation in the database that gives the same result as what the C# function provides on the client side.</span></span> <span data-ttu-id="7de1b-149">それを実現するための実際の変換が、データベース関数より複雑になることがあります。</span><span class="sxs-lookup"><span data-stu-id="7de1b-149">Sometimes, to achieve that, the actual translation could be something more complicated than a database function.</span></span> <span data-ttu-id="7de1b-150">シナリオによっては、C# の一致するセマンティクスではなく、最も適切な変換が提供されることもあります。</span><span class="sxs-lookup"><span data-stu-id="7de1b-150">In some scenarios, we also provide the most appropriate translation rather than matching C# semantics.</span></span> <span data-ttu-id="7de1b-151">また、同じ機能を使用して、一部の C# メンバー アクセスに共通の変換を提供することもできます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-151">The same feature is also used to provide common translations for some of the C# member accesses.</span></span> <span data-ttu-id="7de1b-152">たとえば、SqlServer では <xref:System.String.Length?displayProperty=nameWithType> は `LEN` に変換されます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-152">For example, <xref:System.String.Length?displayProperty=nameWithType> translates to `LEN` in SqlServer.</span></span> <span data-ttu-id="7de1b-153">プロバイダーとは別に、プラグイン ライターも変換を追加できます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-153">Apart from providers, plugin writers can also add additional translations.</span></span> <span data-ttu-id="7de1b-154">この拡張性は、プラグインによってプリミティブ型としてさらに多くの型のサポートが追加され、それらに対してメソッドを変換する必要がある場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="7de1b-154">This extensibility is useful when plugins add support for more types as primitive types and want to translate methods over them.</span></span>

### <a name="effunctions-mapping"></a><span data-ttu-id="7de1b-155">EF.Functions のマッピング</span><span class="sxs-lookup"><span data-stu-id="7de1b-155">EF.Functions mapping</span></span>

<span data-ttu-id="7de1b-156">すべてのデータベース関数に同等の C# 関数があるわけではないため、EF Core プロバイダーには特定のデータベース関数を呼び出すための特別な C# メソッドがあります。</span><span class="sxs-lookup"><span data-stu-id="7de1b-156">Since not all database functions have equivalent C# functions, EF Core providers have special C# methods to invoke certain database functions.</span></span> <span data-ttu-id="7de1b-157">これらのメソッドは、LINQ クエリで使用される `EF.Functions` への拡張メソッドとして定義されています。</span><span class="sxs-lookup"><span data-stu-id="7de1b-157">These methods are defined as extension methods over `EF.Functions` to be used in LINQ queries.</span></span> <span data-ttu-id="7de1b-158">これらのメソッドは、特定のデータベース関数と密接に関連付けられているため、プロバイダー固有です。</span><span class="sxs-lookup"><span data-stu-id="7de1b-158">These methods are provider-specific as they're closely tied with particular database functions.</span></span> <span data-ttu-id="7de1b-159">そのため、あるプロバイダーで動作するメソッドが、他のプロバイダーでは機能しない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7de1b-159">So a method that works for one provider will likely not work for any other provider.</span></span> <span data-ttu-id="7de1b-160">さらに、これらのメソッドの目的は、変換されたクエリでデータベース関数を呼び出すことであるため、クライアントでそれらを評価しようとすると例外になります。</span><span class="sxs-lookup"><span data-stu-id="7de1b-160">Further, since the intention of these methods is to invoke a database function in the translated query, trying to evaluate them on the client results in an exception.</span></span>

### <a name="user-defined-function-mapping"></a><span data-ttu-id="7de1b-161">ユーザー定義関数のマッピング</span><span class="sxs-lookup"><span data-stu-id="7de1b-161">User-defined function mapping</span></span>

<span data-ttu-id="7de1b-162">EF Core プロバイダーによって提供されるマッピングとは別に、ユーザーがカスタム マッピングを定義することもできます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-162">Apart from mappings provided by EF Core providers, users can also define custom mapping.</span></span> <span data-ttu-id="7de1b-163">ユーザー定義のマッピングを使用すると、ユーザーのニーズに応じてクエリの変換を拡張できます。</span><span class="sxs-lookup"><span data-stu-id="7de1b-163">A user-defined mapping extends the query translation according to the user needs.</span></span> <span data-ttu-id="7de1b-164">この機能は、ユーザーが LINQ クエリから呼び出したいユーザー定義関数がデータベースに存在する場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="7de1b-164">This functionality is useful when there are user-defined functions in the database, which the user wants to invoke from their LINQ query.</span></span>

## <a name="see-also"></a><span data-ttu-id="7de1b-165">関連項目</span><span class="sxs-lookup"><span data-stu-id="7de1b-165">See also</span></span>

- [<span data-ttu-id="7de1b-166">SqlServer の組み込み関数のマッピング</span><span class="sxs-lookup"><span data-stu-id="7de1b-166">SqlServer built-in function mappings</span></span>](xref:core/providers/sql-server/functions)
- [<span data-ttu-id="7de1b-167">SQLite の組み込み関数のマッピング</span><span class="sxs-lookup"><span data-stu-id="7de1b-167">Sqlite built-in function mappings</span></span>](xref:core/providers/sqlite/functions)
- [<span data-ttu-id="7de1b-168">Cosmos の組み込み関数のマッピング</span><span class="sxs-lookup"><span data-stu-id="7de1b-168">Cosmos built-in function mappings</span></span>](xref:core/providers/cosmos/functions)
