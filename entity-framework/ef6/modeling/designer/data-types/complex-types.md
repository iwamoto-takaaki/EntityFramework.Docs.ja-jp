---
title: 複合型-EF デザイナー-EF6
description: 複合型-Entity Framework 6 の EF デザイナー
author: divega
ms.date: 10/23/2016
ms.assetid: 9a8228ef-acfd-4575-860d-769d2c0e18a1
uid: ef6/modeling/designer/data-types/complex-types
ms.openlocfilehash: 87b62c119894486cbb54adfc8d3af6208a6618a8
ms.sourcegitcommit: 7c3939504bb9da3f46bea3443638b808c04227c2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/09/2020
ms.locfileid: "89620599"
---
# <a name="complex-types---ef-designer"></a>複合型-EF デザイナー
このトピックでは、複合型を Entity Framework Designer (EF デザイナー) にマップする方法と、複合型のプロパティを含むエンティティに対してクエリを実行する方法について説明します。

次の図は、EF デザイナーを操作するときに使用されるメインウィンドウを示しています。

![EF デザイナー](~/ef6/media/efdesigner.png)

> [!NOTE]
> 概念モデルをビルドすると、マップされていないエンティティとアソシエーションについての警告が [エラー一覧] に表示される場合があります。 モデルからデータベースを生成することを選択すると、エラーが解消されるため、これらの警告は無視してかまいません。

## <a name="what-is-a-complex-type"></a>複合型とは

複合型はエンティティ型の非スカラー プロパティで、これによってスカラー プロパティをエンティティ内で整理できます。 エンティティと同様に、複合型はスカラー プロパティまたは他の複合型プロパティで構成されています。

複合型を表すオブジェクトを操作する場合は、次の点に注意してください。

-   複合型にはキーがないため、独立して存在することはできません。 複合型は、エンティティ型またはその他の複合型のプロパティとしてのみ存在できます。
-   複合型はアソシエーションに参加できず、ナビゲーションプロパティを含むことはできません。
-   複合型プロパティを **null**にすることはできません。 **Dbcontext**が呼び出され、 **InvalidOperationException **   null の複合オブジェクトが検出されると、InvalidOperationException が発生します。 複合オブジェクトのスカラープロパティは **null**にすることができます。
-   複合型は他の複合型を継承できません。
-   複合型は **クラス**として定義する必要があります。 
-   EF の **変更** が呼び出されると、複合型オブジェクトのメンバーに対する変更が検出されます。 Entity Framework は、次のメンバーが呼び出されたときに、検出された **変更** を自動的に呼び出します: **Dbset. Find**, **dbset. Local**, dbset. **Remove**, dbset **.** **Attach** **,** Dbset. ' dbset. **getvalidationerrors**, **dbset. Entry**, **dbchangetracker.** エントリ。

## <a name="refactor-an-entitys-properties-into-new-complex-type"></a>エンティティのプロパティを新しい複合型にリファクタリングする

概念モデルにエンティティが既に存在する場合は、一部のプロパティを複合型プロパティにリファクタリングすることができます。

デザイナー画面で、エンティティの1つ以上のプロパティ (ナビゲーションプロパティを除く) を選択し、右クリックして [ **リファクター- &gt; 新しい複合型に移動**] を選択します。

![新しい複合型へのリファクター](~/ef6/media/refactor.png)

選択したプロパティを持つ新しい複合型が **モデルブラウザー**に追加されます。 複合型には既定の名前が付きます。

新しく作成した型の複合プロパティが、選択したプロパティと置き換わります。 プロパティのマッピングはすべて保持されます。

![新しい複合型へのリファクター2](~/ef6/media/refactor2.png)

## <a name="create-a-new-complex-type"></a>新しい複合型を作成する

また、既存のエンティティのプロパティを含まない新しい複合型を作成することもできます。

モデルブラウザーで [ **複合型** ] フォルダーを右クリックし、[ **AddNew 複合型...**] をポイントします。 または、[**複合型**] フォルダーを選択し、 **Insert**   キーボードの ins キーを押します。

![新しい複合型の追加](~/ef6/media/addnewcomplextype.png)

既定の名前を持つ新しい複合型がフォルダーに追加されます。 これで、型にプロパティを追加できるようになりました。

## <a name="add-properties-to-a-complex-type"></a>複合型へのプロパティの追加

複合型のプロパティはスカラー型か既存の複合型にすることができます。 ただし、複合型のプロパティに循環参照を含めることはできません。 たとえば、複合型 **OnsiteCourseDetails**は、   複合型 **OnsiteCourseDetails**のプロパティを持つことはできません。

以下のいずれかの方法で、複合型にプロパティを追加できます。

-   モデルブラウザーで複合型を右クリックし、[ **追加**] をポイントします。次に、[ **スカラープロパティ**   ] または [ **複合プロパティ**] をポイントし、目的のプロパティの種類を選択します。 または、複合型を選択し、 **Insert**   キーボードの ins キーを押します。  

    ![複合型へのプロパティの追加](~/ef6/media/addpropertiestocomplextype.png)

    既定の名前を持つ新しいプロパティが複合型に追加されます。

- または -

-   **EF デザイナー**画面でエンティティプロパティを右クリックし、[ **コピー**] をクリックします。次に、**モデルブラウザー**で複合型を右クリックし、[ **貼り付け**] を選択します。

## <a name="rename-a-complex-type"></a>複合型の名前を変更する

複合型の名前を変更すると、その型へのすべての参照がプロジェクト全体で更新されます。

-   **モデルブラウザー**で複合型をゆっくりとダブルクリックします。
    名前が選択され、編集モードになります。

- または -

-   **モデルブラウザー**で複合型を右クリックし、[ **名前の変更**] を選択します。

- または -

-   モデル ブラウザーで複合型を選択し、F2 キーを押します。

- または -

-   **モデルブラウザー**で複合型を右クリックし、[ **プロパティ**] を選択します。 [ **プロパティ**] ウィンドウで名前を編集し   ます。

## <a name="add-an-existing-complex-type-to-an-entity-and-map-its-properties-to-table-columns"></a>既存の複合型をエンティティに追加し、そのプロパティをテーブル列にマップします。

1.  エンティティを右クリックして [ **新規追加**] をポイントし、[ **複合プロパティ**] を選択します。
    既定の名前を持つ複合型プロパティがエンティティに追加されます。 既存の複合型から選択した既定の型がプロパティに割り当てられます。
2.  [ **プロパティ**] ウィンドウで、目的の型をプロパティに割り当て   ます。
    複合型プロパティをエンティティに追加した後、そのプロパティをテーブル列にマップする必要があります。
3.  デザイン画面または **モデルブラウザー**でエンティティ型を右クリック   し、[ **テーブルマッピング**] を選択します。
    [ **マッピングの詳細**] ウィンドウにテーブルマッピングが表示され   ます。
4.  [ **マップ先 &lt; テーブル名 &gt; **] ノードを展開し   ます。
     **列マッピング**   ノードが表示されます。
5.  [ **列マッピング**] ノードを展開し   ます。
    テーブル内のすべての列の一覧が表示されます。 列マップの既定のプロパティ (存在する場合) は、[ **値/プロパティ**] 見出しの下に一覧表示され   ます。
6.  マップする列を選択し、対応する [ **値/プロパティ**] フィールドを右クリックし   ます。
    すべてのスカラー プロパティのドロップダウン リストが表示されます。
7.  適切なプロパティを選択します。

    ![マップの複合型](~/ef6/media/mapcomplextype.png)

8.  各テーブル列ごとに、手順 6. と 7. を繰り返します。

>[!NOTE]
> 列マッピングを削除するには、マップする列を選択し、[ **値/プロパティ**   ] フィールドをクリックします。 次に、ドロップダウンリストから [ **削除** ] を選択します。

## <a name="map-a-function-import-to-a-complex-type"></a>関数インポートを複合型にマップする

関数インポートは、ストアド プロシージャに基づいています。 関数インポートを複合型にマップするには、対応するストアド プロシージャが返す列の数が複合型のプロパティの数と一致するようにし、ストレージ型がプロパティ型と互換性があるようにする必要があります。

-   複合型にマップするインポートされた関数をダブルクリックします。

    ![関数インポート](~/ef6/media/functionimports.png)

-   新しい関数インポートの設定を、次のように入力します。
    -   [ **ストアドプロシージャ名**] フィールドで、関数インポートを作成するストアドプロシージャを指定し   ます。 このフィールドは、ストレージ モデル内のすべてのストアド プロシージャが表示されるドロップダウン リストです。
    -   関数インポートの名前を [ **関数インポート名**   ] フィールドに指定します。
    -    **Complex**   戻り値の型として [複合] を選択し、ドロップダウンリストから適切な型を選択して、特定の複合戻り値の型を指定します。

        ![関数インポートの編集](~/ef6/media/editfunctionimport.png)

-    **[OK]** をクリックします。
    関数インポート エントリが概念モデルに作成されます。

### <a name="customize-column-mapping-for-function-import"></a>関数インポートの列マッピングのカスタマイズ

-   モデルブラウザーで関数インポートを右クリックし、[ **関数インポートマッピング**] を選択します。
    [ **マッピングの詳細**   ] ウィンドウが表示され、関数インポートの既定のマッピングが表示されます。 矢印は、列の値とプロパティの値の間のマッピングを示します。 既定では、列名は、複合型のプロパティ名と同じであるものとされます。 既定の列名は、グレーのテキストで表示されます。
-   必要に応じて、関数インポートに対応するストアド プロシージャにより返される列名と一致するように、列名を変更します。

## <a name="delete-a-complex-type"></a>複合型の削除

複合型を削除すると、概念モデルからその型が削除され、その型のすべてのインスタンスのマッピングが削除されます。 ただし、その型への参照は更新されません。 たとえば、エンティティに ComplexType1 型の複合型プロパティがあり、ComplexType1 が **モデルブラウザー**で削除されている場合、対応するエンティティプロパティは更新されません。 削除された複合型を参照するエンティティが含まれているため、モデルは検証されません。 エンティティ デザイナーを使用すると、削除された複合型への参照を更新または削除できます。

-   モデルブラウザーで複合型を右クリックし、[ **削除**] を選択します。

- または -

-   モデル ブラウザーで複合型を選択し、キーボードの Del キーを押します。

## <a name="query-for-entities-containing-properties-of-complex-type"></a>複合型のプロパティを含むエンティティのクエリ

次のコードは、複合型プロパティを含むエンティティ型オブジェクトのコレクションを返すクエリを実行する方法を示しています。

``` csharp
    using (SchoolEntities context = new SchoolEntities())
    {
        var courses =
            from c in context.OnsiteCourses
            order by c.Details.Time
            select c;

        foreach (var c in courses)
        {
            Console.WriteLine("Time: " + c.Details.Time);
            Console.WriteLine("Days: " + c.Details.Days);
            Console.WriteLine("Location: " + c.Details.Location);
        }
    }
```
