---
title: migrate.exe-EF6 の使用
description: Entity Framework 6 での migrate.exe の使用
author: ajcvickers
ms.date: 10/23/2016
uid: ef6/modeling/code-first/migrations/migrate-exe
ms.openlocfilehash: f57f56f7e3fe876c7265526bf6541e3c9e91ca7d
ms.sourcegitcommit: 0a25c03fa65ae6e0e0e3f66bac48d59eceb96a5a
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/14/2020
ms.locfileid: "92066370"
---
# <a name="using-migrateexe"></a><span data-ttu-id="283f4-103">migrate.exe の使用</span><span class="sxs-lookup"><span data-stu-id="283f4-103">Using migrate.exe</span></span>
<span data-ttu-id="283f4-104">Code First Migrations は、visual studio 内からデータベースを更新するために使用できますが、コマンドラインツール migrate.exe を使用して実行することもできます。</span><span class="sxs-lookup"><span data-stu-id="283f4-104">Code First Migrations can be used to update a database from inside visual studio, but can also be executed via the command line tool migrate.exe.</span></span> <span data-ttu-id="283f4-105">このページでは、migrate.exe を使用してデータベースに対して移行を実行する方法の概要を簡単に説明します。</span><span class="sxs-lookup"><span data-stu-id="283f4-105">This page will give a quick overview on how to use migrate.exe to execute migrations against a database.</span></span>

> [!NOTE]
> <span data-ttu-id="283f4-106">この記事では、基本的なシナリオでの Code First Migrations の使用方法を理解していることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="283f4-106">This article assumes you know how to use Code First Migrations in basic scenarios.</span></span> <span data-ttu-id="283f4-107">そうでない場合は、続行する前に [Code First Migrations](xref:ef6/modeling/code-first/migrations/index) を読む必要があります。</span><span class="sxs-lookup"><span data-stu-id="283f4-107">If you don’t, then you’ll need to read [Code First Migrations](xref:ef6/modeling/code-first/migrations/index) before continuing.</span></span>

## <a name="copy-migrateexe"></a><span data-ttu-id="283f4-108">migrate.exe のコピー</span><span class="sxs-lookup"><span data-stu-id="283f4-108">Copy migrate.exe</span></span>

<span data-ttu-id="283f4-109">NuGet を使用して Entity Framework をインストールすると、ダウンロードしたパッケージの tools フォルダー内に migrate.exe が作成されます。</span><span class="sxs-lookup"><span data-stu-id="283f4-109">When you install Entity Framework using NuGet migrate.exe will be inside the tools folder of the downloaded package.</span></span> <span data-ttu-id="283f4-110">&lt;プロジェクトフォルダー &gt; \\ パッケージ \\ entityframework。 &lt;バージョン &gt; \\ ツール</span><span class="sxs-lookup"><span data-stu-id="283f4-110">In &lt;project folder&gt;\\packages\\EntityFramework.&lt;version&gt;\\tools</span></span>

<span data-ttu-id="283f4-111">migrate.exe したら、移行を含むアセンブリの場所にコピーする必要があります。</span><span class="sxs-lookup"><span data-stu-id="283f4-111">Once you have migrate.exe then you need to copy it to the location of the assembly that contains your migrations.</span></span>

<span data-ttu-id="283f4-112">アプリケーションが4.5 ではなく .NET 4 を対象としている場合は、その場所にも **Redirect.config** をコピーし **migrate.exe.config**名前を変更する必要があります。これは、migrate.exe が Entity Framework アセンブリを検索できるように、正しいバインディングリダイレクトを取得できるようにするためです。</span><span class="sxs-lookup"><span data-stu-id="283f4-112">If your application targets .NET 4, and not 4.5, then you will need to copy the **Redirect.config** into the location as well and rename it **migrate.exe.config**. This is so that migrate.exe gets the correct binding redirects to be able to locate the Entity Framework assembly.</span></span>

| <span data-ttu-id="283f4-113">.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="283f4-113">.NET 4.5</span></span>                                      | <span data-ttu-id="283f4-114">.NET 4.0</span><span class="sxs-lookup"><span data-stu-id="283f4-114">.NET 4.0</span></span>                                      |
|:----------------------------------------------|:----------------------------------------------|
| ![.NET 4.5 ファイル](~/ef6/media/net45files.png) | ![.NET 4.0 ファイル](~/ef6/media/net40files.png) |

> [!NOTE]
> <span data-ttu-id="283f4-117">migrate.exe は x64 アセンブリをサポートしていません。</span><span class="sxs-lookup"><span data-stu-id="283f4-117">migrate.exe doesn't support x64 assemblies.</span></span>

<span data-ttu-id="283f4-118">migrate.exe を適切なフォルダーに移動すると、そのフォルダーを使用してデータベースに対して移行を実行できるようになります。</span><span class="sxs-lookup"><span data-stu-id="283f4-118">Once you have moved migrate.exe to the correct folder then you should be able to use it to execute migrations against the database.</span></span> <span data-ttu-id="283f4-119">すべてのユーティリティは、移行を実行するように設計されています。</span><span class="sxs-lookup"><span data-stu-id="283f4-119">All the utility is designed to do is execute migrations.</span></span> <span data-ttu-id="283f4-120">移行を生成したり、SQL スクリプトを作成したりすることはできません。</span><span class="sxs-lookup"><span data-stu-id="283f4-120">It cannot generate migrations or create a SQL script.</span></span>

## <a name="see-options"></a><span data-ttu-id="283f4-121">オプションを表示する</span><span class="sxs-lookup"><span data-stu-id="283f4-121">See options</span></span>

``` console
Migrate.exe /?
```

<span data-ttu-id="283f4-122">上の例では、このユーティリティに関連付けられているヘルプページが表示されます。これが機能するには、migrate.exe 実行しているのと同じ場所に EntityFramework.dll が必要です。</span><span class="sxs-lookup"><span data-stu-id="283f4-122">The above will display the help page associated with this utility, note that you will need to have the EntityFramework.dll in the same location that you are running migrate.exe in order for this to work.</span></span>

## <a name="migrate-to-the-latest-migration"></a><span data-ttu-id="283f4-123">最新の移行に移行する</span><span class="sxs-lookup"><span data-stu-id="283f4-123">Migrate to the latest migration</span></span>

``` console
Migrate.exe MyMvcApplication.dll /startupConfigurationFile="..\\web.config"
```

<span data-ttu-id="283f4-124">migrate.exe 実行する場合、唯一の必須パラメーターは、実行しようとしている移行を含むアセンブリであるアセンブリですが、構成ファイルを指定しない場合は、規則ベースのすべての設定が使用されます。</span><span class="sxs-lookup"><span data-stu-id="283f4-124">When running migrate.exe the only mandatory parameter is the assembly, which is the assembly that contains the migrations that you are trying to run, but it will use all convention based settings if you do not specify the configuration file.</span></span>

## <a name="migrate-to-a-specific-migration"></a><span data-ttu-id="283f4-125">特定の移行に移行する</span><span class="sxs-lookup"><span data-stu-id="283f4-125">Migrate to a specific migration</span></span>

``` console
Migrate.exe MyApp.exe /startupConfigurationFile="MyApp.exe.config" /targetMigration="AddTitle"
```

<span data-ttu-id="283f4-126">特定の移行までの移行を実行する場合は、移行の名前を指定できます。</span><span class="sxs-lookup"><span data-stu-id="283f4-126">If you want to run migrations up to a specific migration, then you can specify the name of the migration.</span></span> <span data-ttu-id="283f4-127">これにより、移行が指定されるまで、必要に応じて以前の移行がすべて実行されます。</span><span class="sxs-lookup"><span data-stu-id="283f4-127">This will run all previous migrations as required until getting to the migration specified.</span></span>

## <a name="specify-working-directory"></a><span data-ttu-id="283f4-128">作業ディレクトリの指定</span><span class="sxs-lookup"><span data-stu-id="283f4-128">Specify working directory</span></span>

``` console
Migrate.exe MyApp.exe /startupConfigurationFile="MyApp.exe.config" /startupDirectory="c:\\MyApp"
```

<span data-ttu-id="283f4-129">アセンブリに依存関係がある場合、または作業ディレクトリを基準としてファイルを読み取る場合は、startupDirectory を設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="283f4-129">If you assembly has dependencies or reads files relative to the working directory then you will need to set startupDirectory.</span></span>

## <a name="specify-migration-configuration-to-use"></a><span data-ttu-id="283f4-130">使用する移行構成の指定</span><span class="sxs-lookup"><span data-stu-id="283f4-130">Specify migration configuration to use</span></span>

``` console
Migrate.exe MyAssembly CustomConfig /startupConfigurationFile="..\\web.config"
```

<span data-ttu-id="283f4-131">複数の移行構成クラス (DbMigrationConfiguration から継承するクラス) がある場合は、この実行に使用するを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="283f4-131">If you have multiple migration configuration classes, classes inheriting from DbMigrationConfiguration, then you need to specify which is to be used for this execution.</span></span> <span data-ttu-id="283f4-132">これは、上記のようにスイッチを指定せずに、省略可能な2番目のパラメーターを指定することで指定します。</span><span class="sxs-lookup"><span data-stu-id="283f4-132">This is specified by providing the optional second parameter without a switch as above.</span></span>

## <a name="provide-connection-string"></a><span data-ttu-id="283f4-133">接続文字列の指定</span><span class="sxs-lookup"><span data-stu-id="283f4-133">Provide connection string</span></span>

``` console
Migrate.exe BlogDemo.dll /connectionString="Data Source=localhost;Initial Catalog=BlogDemo;Integrated Security=SSPI" /connectionProviderName="System.Data.SqlClient"
```

<span data-ttu-id="283f4-134">コマンドラインで接続文字列を指定する場合は、プロバイダー名も指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="283f4-134">If you wish to specify a connection string at the command line then you must also provide the provider name.</span></span> <span data-ttu-id="283f4-135">プロバイダー名を指定しないと、例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="283f4-135">Not specifying the provider name will cause an exception.</span></span>

## <a name="common-problems"></a><span data-ttu-id="283f4-136">一般的な問題</span><span class="sxs-lookup"><span data-stu-id="283f4-136">Common Problems</span></span>

| <span data-ttu-id="283f4-137">エラー メッセージ</span><span class="sxs-lookup"><span data-stu-id="283f4-137">Error Message</span></span>                                                                                                                                                                                                                                                                                                                      | <span data-ttu-id="283f4-138">解決策</span><span class="sxs-lookup"><span data-stu-id="283f4-138">Solution</span></span>                                                                                                                                                                                                                                                                                             |
|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="283f4-139">ハンドルされない例外: FileLoadException: ファイルまたはアセンブリ ' EntityFramework、Version = 5.0.0.0、Culture = ニュートラル、PublicKeyToken = b77a5c561934e089 '、またはその依存関係の1つを読み込むことができませんでした。</span><span class="sxs-lookup"><span data-stu-id="283f4-139">Unhandled Exception: System.IO.FileLoadException:  Could not load file or assembly 'EntityFramework, Version=5.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089' or one of its dependencies.</span></span> <span data-ttu-id="283f4-140">見つかったアセンブリのマニフェスト定義がアセンブリ参照と一致しません。</span><span class="sxs-lookup"><span data-stu-id="283f4-140">The located assembly's manifest definition does not match the assembly reference.</span></span> <span data-ttu-id="283f4-141">(HRESULT からの例外: 0x80131040)</span><span class="sxs-lookup"><span data-stu-id="283f4-141">(Exception from HRESULT: 0x80131040)</span></span>         | <span data-ttu-id="283f4-142">これは、通常、Redirect.config ファイルを使用せずに .NET 4 アプリケーションを実行していることを意味します。</span><span class="sxs-lookup"><span data-stu-id="283f4-142">This typically means that you are running a .NET 4 application without the Redirect.config file.</span></span> <span data-ttu-id="283f4-143">Redirect.config を migrate.exe と同じ場所にコピーし、名前を migrate.exe.config に変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="283f4-143">You need to copy the Redirect.config to the same location as migrate.exe and rename it to migrate.exe.config.</span></span>                                                                                       |
| <span data-ttu-id="283f4-144">ハンドルされない例外: FileLoadException: ファイルまたはアセンブリ ' EntityFramework、Version = 4.4.0.0、Culture = ニュートラル、PublicKeyToken = b77a5c561934e089 '、またはその依存関係の1つを読み込むことができませんでした。</span><span class="sxs-lookup"><span data-stu-id="283f4-144">Unhandled Exception: System.IO.FileLoadException: Could not load file or assembly 'EntityFramework, Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089' or one of its dependencies.</span></span> <span data-ttu-id="283f4-145">見つかったアセンブリのマニフェスト定義がアセンブリ参照と一致しません。</span><span class="sxs-lookup"><span data-stu-id="283f4-145">The located assembly's manifest definition does not match the assembly reference.</span></span> <span data-ttu-id="283f4-146">(HRESULT からの例外: 0x80131040)</span><span class="sxs-lookup"><span data-stu-id="283f4-146">(Exception from HRESULT: 0x80131040)</span></span>          | <span data-ttu-id="283f4-147">この例外は、Redirect.config が migrate.exe の場所にコピーされた .NET 4.5 アプリケーションを実行していることを意味します。</span><span class="sxs-lookup"><span data-stu-id="283f4-147">This exception means that you are running a .NET 4.5 application with the Redirect.config copied to the migrate.exe location.</span></span> <span data-ttu-id="283f4-148">アプリが .NET 4.5 の場合、構成ファイルが内にリダイレクトされる必要はありません。</span><span class="sxs-lookup"><span data-stu-id="283f4-148">If your app is .NET 4.5 then you do not need to have the config file with the redirects inside.</span></span> <span data-ttu-id="283f4-149">migrate.exe.config ファイルを削除します。</span><span class="sxs-lookup"><span data-stu-id="283f4-149">Delete the migrate.exe.config file.</span></span>                                    |
| <span data-ttu-id="283f4-150">エラー: 保留中の変更があり、自動移行が無効になっているため、現在のモデルに一致するようにデータベースを更新できません。</span><span class="sxs-lookup"><span data-stu-id="283f4-150">ERROR: Unable to update database to match the current model because there are pending changes and automatic migration is disabled.</span></span> <span data-ttu-id="283f4-151">保留中のモデルの変更をコードベースの移行に書き込むか、自動移行を有効にします。</span><span class="sxs-lookup"><span data-stu-id="283f4-151">Either write the pending model changes to a code-based migration or enable automatic migration.</span></span> <span data-ttu-id="283f4-152">自動移行を有効にするには、DbMigrationsConfiguration を true に設定します。</span><span class="sxs-lookup"><span data-stu-id="283f4-152">Set DbMigrationsConfiguration.AutomaticMigrationsEnabled to true to enable automatic migration.</span></span> | <span data-ttu-id="283f4-153">このエラーは、モデルに対して行われた変更に対処するために移行を作成していない場合に、データベースがモデルと一致しない場合に発生します。</span><span class="sxs-lookup"><span data-stu-id="283f4-153">This error occurs if running migrate when you haven’t created a migration to cope with changes made to the model, and the database does not match the model.</span></span> <span data-ttu-id="283f4-154">モデルクラスにプロパティを追加し、データベースをアップグレードするための移行を作成せずに migrate.exe を実行する例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="283f4-154">Adding a property to a model class then running migrate.exe without creating a migration to upgrade the database is an example of this.</span></span> |
| <span data-ttu-id="283f4-155">エラー: メンバー ' UpdateRunner、EntityFramework、Version = 5.0.0.0、Culture = ニュートラル、PublicKeyToken = b77a5c561934e089 ' の型が解決されていません。このエラーが発生しました。</span><span class="sxs-lookup"><span data-stu-id="283f4-155">ERROR: Type is not resolved for member 'System.Data.Entity.Migrations.Design.ToolingFacade+UpdateRunner,EntityFramework, Version=5.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.</span></span>                                                                                                                                       | <span data-ttu-id="283f4-156">このエラーは、無効なスタートアップディレクトリを指定することによって発生することがあります。</span><span class="sxs-lookup"><span data-stu-id="283f4-156">This error can be caused by specifying an incorrect startup directory.</span></span> <span data-ttu-id="283f4-157">これは migrate.exe の場所である必要があります</span><span class="sxs-lookup"><span data-stu-id="283f4-157">This must be the location of migrate.exe</span></span>                                                                                                                                                                                      |
| <span data-ttu-id="283f4-158">未処理の例外: NullReferenceException: オブジェクト参照がオブジェクトのインスタンスに設定されていません。</span><span class="sxs-lookup"><span data-stu-id="283f4-158">Unhandled Exception: System.NullReferenceException: Object reference not set to an instance of an object.</span></span> <br/>   <span data-ttu-id="283f4-159">at.......................................</span><span class="sxs-lookup"><span data-stu-id="283f4-159">at System.Data.Entity.Migrations.Console.Program.Main(String[] args)</span></span>                                                                                                                                             | <span data-ttu-id="283f4-160">これは、使用しているシナリオに必要なパラメーターを指定していないことが原因である可能性があります。</span><span class="sxs-lookup"><span data-stu-id="283f4-160">This can be caused by not specifying a required parameter for a scenario that you are using.</span></span> <span data-ttu-id="283f4-161">たとえば、プロバイダー名を指定せずに接続文字列を指定します。</span><span class="sxs-lookup"><span data-stu-id="283f4-161">For example specifying a connection string without specifying the provider name.</span></span>                                                                                                                        |
| <span data-ttu-id="283f4-162">エラー: アセンブリ ' と ' で、複数の移行構成の種類が見つかりました。</span><span class="sxs-lookup"><span data-stu-id="283f4-162">ERROR: More than one migrations configuration type was found in the assembly 'ClassLibrary1'.</span></span> <span data-ttu-id="283f4-163">使用する名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="283f4-163">Specify the name of the one to use.</span></span>                                                                                                                                                                                                  | <span data-ttu-id="283f4-164">エラー状態が発生すると、指定されたアセンブリに複数の構成クラスが存在します。</span><span class="sxs-lookup"><span data-stu-id="283f4-164">As the error states, there is more than one configuration class in the given assembly.</span></span> <span data-ttu-id="283f4-165">使用するを指定するには、/configurationType スイッチを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="283f4-165">You must use the /configurationType switch to specify which to use.</span></span>                                                                                                                                           |
| <span data-ttu-id="283f4-166">エラー: ファイルまたはアセンブリ ' &lt; assemblyName &gt; ' またはその依存関係の1つを読み込むことができませんでした。</span><span class="sxs-lookup"><span data-stu-id="283f4-166">ERROR: Could not load file or assembly ‘&lt;assemblyName&gt;’ or one of its dependencies.</span></span> <span data-ttu-id="283f4-167">指定されたアセンブリ名またはコードベースが無効です。</span><span class="sxs-lookup"><span data-stu-id="283f4-167">The given assembly name or codebase was invalid.</span></span> <span data-ttu-id="283f4-168">(HRESULT からの例外: 0x80131047)</span><span class="sxs-lookup"><span data-stu-id="283f4-168">(Exception from HRESULT: 0x80131047)</span></span>                                                                                                                                                    | <span data-ttu-id="283f4-169">これは、アセンブリ名の指定に誤りがあるか、</span><span class="sxs-lookup"><span data-stu-id="283f4-169">This can be caused by specifying an assembly name incorrectly or not having</span></span>                                                                                                                                                                                                                          |
| <span data-ttu-id="283f4-170">エラー: ファイルまたはアセンブリ ' &lt; assemblyName &gt; ' またはその依存関係の1つを読み込むことができませんでした。</span><span class="sxs-lookup"><span data-stu-id="283f4-170">ERROR: Could not load file or assembly ‘&lt;assemblyName&gt;' or one of its dependencies.</span></span> <span data-ttu-id="283f4-171">正しくない形式のプログラムを読み込もうとしました。</span><span class="sxs-lookup"><span data-stu-id="283f4-171">An attempt was made to load a program with an incorrect format.</span></span>                                                                                                                                                                          | <span data-ttu-id="283f4-172">これは、x64 アプリケーションに対して migrate.exe を実行しようとした場合に発生します。</span><span class="sxs-lookup"><span data-stu-id="283f4-172">This happens if you are trying to run migrate.exe against an x64 application.</span></span> <span data-ttu-id="283f4-173">EF 5.0 以降は、x86 でのみ機能します。</span><span class="sxs-lookup"><span data-stu-id="283f4-173">EF 5.0 and below will only work on x86.</span></span>                                                                                                                                                                                |
