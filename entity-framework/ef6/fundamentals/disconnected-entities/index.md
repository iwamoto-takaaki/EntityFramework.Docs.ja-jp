---
title: 接続解除エンティティの使用 - EF6
author: divega
ms.date: 10/23/2016
ms.assetid: 12138003-a373-4817-b1b7-724130202f5f
ms.openlocfilehash: f1ce44e7b00ec4c60a81ed850ce5c9d866495e1b
ms.sourcegitcommit: 9b562663679854c37c05fca13d93e180213fb4aa
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/07/2020
ms.locfileid: "78413367"
---
# <a name="working-with-disconnected-entities"></a><span data-ttu-id="8b818-102">接続解除エンティティの使用</span><span class="sxs-lookup"><span data-stu-id="8b818-102">Working with disconnected entities</span></span>
<span data-ttu-id="8b818-103">Entity Framework ベースのアプリケーションでは、追跡しているエンティティに適用された変更はコンテキスト クラスが検出します。</span><span class="sxs-lookup"><span data-stu-id="8b818-103">In an Entity Framework-based application, a context class is responsible for detecting changes applied to tracked entities.</span></span> <span data-ttu-id="8b818-104">SaveChanges メソッドを呼び出すと、コンテキストによって追跡された変更がデータベースに永続化されます。</span><span class="sxs-lookup"><span data-stu-id="8b818-104">Calling the SaveChanges method persists the changes tracked by the context to the database.</span></span> <span data-ttu-id="8b818-105">n 層アプリケーションを使用する場合、エンティティ オブジェクトはコンテキストから切り離されるときに通常変更され、変更を追跡する方法およびそれらの変更をコンテキストにレポートする方法を決定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8b818-105">When working with n-tier applications, entity objects are usually modified while disconnected from the context, and you must decide how to track changes and report those changes back to the context.</span></span> <span data-ttu-id="8b818-106">このトピックでは、Entity Framework で接続解除エンティティを使用するときに使用できるさまざまなオプションについて説明します。</span><span class="sxs-lookup"><span data-stu-id="8b818-106">This topic discusses different options that are available when using Entity Framework with disconnected entities.</span></span>   

## <a name="web-service-frameworks"></a><span data-ttu-id="8b818-107">Web サービス フレームワーク</span><span class="sxs-lookup"><span data-stu-id="8b818-107">Web service frameworks</span></span>

<span data-ttu-id="8b818-108">Web サービス テクノロジでは、個々の接続解除オブジェクトの変更の永続化に使用できるパターンを通常サポートしています。</span><span class="sxs-lookup"><span data-stu-id="8b818-108">Web services technologies typically support patterns that can be used to persist changes on individual disconnected objects.</span></span> <span data-ttu-id="8b818-109">たとえば、ASP.NET Web API では、データベース上のオブジェクトへの変更を永続化できる EF に対する呼び出しを含めることができるコントローラー アクションをコーディングできます。</span><span class="sxs-lookup"><span data-stu-id="8b818-109">For example, ASP.NET Web API allows you to code controller actions that can include calls to EF to persist changes made to an object on a database.</span></span> <span data-ttu-id="8b818-110">実際、Visual Studio の Web API ツールでは、Entity Framework 6 モデルから Web API コントローラーを容易にスキャフォールディングできます。</span><span class="sxs-lookup"><span data-stu-id="8b818-110">In fact, the Web API tooling in Visual Studio makes it easy to scaffold a Web API controller from your Entity Framework 6 model.</span></span> <span data-ttu-id="8b818-111">詳細については、「[Using Web API with Entity Framework 6](https://docs.microsoft.com/aspnet/web-api/overview/data/using-web-api-with-entity-framework/)」 (Entity Framework 6 での Web API の使用) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8b818-111">For more information, see [using Web API with Entity Framework 6](https://docs.microsoft.com/aspnet/web-api/overview/data/using-web-api-with-entity-framework/).</span></span>   

<span data-ttu-id="8b818-112">今までには、[WCF Data Services](https://docs.microsoft.com/dotnet/framework/data/wcf/create-a-data-service-using-an-adonet-ef-data-wcf) や [RIA Services](https://docs.microsoft.com/previous-versions/dotnet/wcf-ria/ee707344(v=vs.91)) など、Entity Framework に統合できる Web サービス テクノロジが他にもいくつかありました。</span><span class="sxs-lookup"><span data-stu-id="8b818-112">Historically, there have been several other Web services technologies that offered integration with Entity Framework, like [WCF Data Services](https://docs.microsoft.com/dotnet/framework/data/wcf/create-a-data-service-using-an-adonet-ef-data-wcf) and [RIA Services](https://docs.microsoft.com/previous-versions/dotnet/wcf-ria/ee707344(v=vs.91)).</span></span>

## <a name="low-level-ef-apis"></a><span data-ttu-id="8b818-113">下位レベルの EF の API</span><span class="sxs-lookup"><span data-stu-id="8b818-113">Low-level EF APIs</span></span>

<span data-ttu-id="8b818-114">既存の n 層ソリューションを使用しない場合や、Web API サービス内のコントローラー アクション内で起こることをカスタマイズしたい場合のために、Entity Framework には、接続解除された層に対して変更を適用する API が用意されています。</span><span class="sxs-lookup"><span data-stu-id="8b818-114">If you don't want to use an existing n-tier solution, or if you want to customize what happens inside a controller action in a Web API services, Entity Framework provides APIs that allow you to apply changes made on a disconnected tier.</span></span> <span data-ttu-id="8b818-115">詳細については、[Add、Attach およびエンティティの状態](~/ef6/saving/change-tracking/entity-state.md)に関する説明を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8b818-115">For more information, see [Add, Attach, and entity state](~/ef6/saving/change-tracking/entity-state.md).</span></span>  

## <a name="self-tracking-entities"></a><span data-ttu-id="8b818-116">自己追跡エンティティ</span><span class="sxs-lookup"><span data-stu-id="8b818-116">Self-Tracking Entities</span></span>  

<span data-ttu-id="8b818-117">EF コンテキストから接続解除されている場合に、エンティティの任意のグラフで変更を追跡することは難しいです。</span><span class="sxs-lookup"><span data-stu-id="8b818-117">Tracking changes on arbitrary graphs of entities while disconnected from the EF context is a hard problem.</span></span> <span data-ttu-id="8b818-118">これを解決する 1 つの試みとして、Self-Tracking Entities ジェネレーション テンプレートがありました。</span><span class="sxs-lookup"><span data-stu-id="8b818-118">One of the attempts to solve it was the Self-Tracking Entities code generation template.</span></span> <span data-ttu-id="8b818-119">このテンプレートは、接続解除された層に対して行われた変更を、エンティティ自体の状態として追跡するロジックを含むエンティティ クラスを生成します。</span><span class="sxs-lookup"><span data-stu-id="8b818-119">This template generates entity classes that contain logic to track changes made on a disconnected tier as state in the entities themselves.</span></span> <span data-ttu-id="8b818-120">それらの変更をコンテキストに適用する、拡張メソッドのセットも生成されています。</span><span class="sxs-lookup"><span data-stu-id="8b818-120">A set of extension methods is also generated to apply those changes to a context.</span></span>

<span data-ttu-id="8b818-121">このテンプレートは、EF Designer を使用して作成されたモデルで使用できますが、Code First のモデルでは使用できません。</span><span class="sxs-lookup"><span data-stu-id="8b818-121">This template can be used with models created using the EF Designer, but can not be used with Code First models.</span></span> <span data-ttu-id="8b818-122">詳細については、「[自己追跡エンティティ](self-tracking-entities/index.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8b818-122">For more information, see [Self-Tracking Entities](self-tracking-entities/index.md).</span></span>  

> [!IMPORTANT]
> <span data-ttu-id="8b818-123">自己追跡エンティティ テンプレートの使用は現在お勧めしていません。</span><span class="sxs-lookup"><span data-stu-id="8b818-123">We no longer recommend using the self-tracking-entities template.</span></span> <span data-ttu-id="8b818-124">既存のアプリケーションをサポートするためにのみ引き続き使用できます。</span><span class="sxs-lookup"><span data-stu-id="8b818-124">It will only continue to be available to support existing applications.</span></span> <span data-ttu-id="8b818-125">アプリケーションで、エンティティの切断されたグラフを操作する必要がある場合は、代替の方法を検討してください。たとえば、コミュニティによってより積極的に開発された自己追跡エンティティに似たテクノロジである[追跡可能なエンティティ](https://trackableentities.github.io/)を使用するか、または、低レベルの変更追跡 API を使用してカスタム コードを記述してください。</span><span class="sxs-lookup"><span data-stu-id="8b818-125">If your application requires working with disconnected graphs of entities, consider other alternatives such as [Trackable Entities](https://trackableentities.github.io/), which is a technology similar to Self-Tracking-Entities that is more actively developed by the community, or writing custom code using the low-level change tracking APIs.</span></span>
